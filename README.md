# Applied_Statistics

## 데이터 출처
공공데이터포털 금융위원회_주식시세정보
- 시가총액, 종가(수익률 제작용)

KRX 정보시스템
- 주식/세부안내/PER,PBR,배당수익률(개별종목)
- 지수/주가지수/개별지수시세추이(시장수익률 제작용)

## 데이터 전처리 흐름
보통주만 추출(ticker 끝자리 0)
리츠 등등과 금융기업 제외 로직(업종분류로 금융기업 걸러내기..?ㅠㅠ)

월 말일 기준 데이터만 추출하여 월별 시가총액 데이터프레임 제작

월 말일 기준으로 수익률 계산하여 월별 수익률 데이터프레임 제작
수익률 데이터프레임에서 월률화한 무위험수익률을 차감하여 월별 초과수익률 데이터프레임 제작

krx 연 말일 기준 BPS 자료 csv로 다운
krx 자료 기준으로 시가총액 데이터프레임 merge해서 12월 상장주식수 * BPS로 bookvalue 데이터프레임 제작
시가총액 데이터프레임 기준으로 bookvalue 데이터프레임을 merge한 후 t년 7월부터 t+1년 6월까지 t-1년 bookvalue를 사용하여 BE/ME 데이터프레임 제작

# BE/ME 계산 시 결측치 확인
1. Value NaN: 상장폐지 위기 및 자본잠식 종목
흥아해운, KG모빌리티(구 쌍용차), 키위미디어그룹 등이 여기에 해당합니다.

의미: KRX 명단에는 존재하지만 BPS(주당순자산) 값이 NaN인 경우입니다.

이유: 이 기업들은 해당 연도에 자본잠식 상태였거나, 감사보고서 의견 거절, 혹은 거래 정지 상태여서 정상적인 재무 지표(BPS) 산출이 불가능했던 종목들입니다.

처리: 퀀트 분석에서 이런 종목들은 가치 평가가 불가능하므로 결측치로 남겨두고 제거하는 것이 맞습니다.

2. Merge Miss: 이전상장 및 신규상장
포스코DX, 파라다이스, 에이피알, 엘앤에프 등이 여기에 해당합니다.

의미: 시가총액 데이터에는 존재하지만, KRX의 연말 BPS 데이터 파일에는 해당 종목이 없는 경우입니다.

이유: * 이전상장 (가장 큰 원인): 포스코DX, 엘앤에프, 파라다이스는 원래 코스닥(KOSDAQ) 종목이었다가 최근에 **코스피(KOSPI)**로 이전상장했습니다. 사용자님은 지금 코스피(kospi_path) 데이터만 불러오고 계시기 때문에, 이들이 코스닥에 있던 시절의 BPS 데이터는 코스피 파일에 존재하지 않아 매칭이 안 된 것입니다.

신규상장: 에이피알, 산일전기 등은 최근에 상장했기 때문에 전년도 말 기준 장부가(bookvalue)가 아예 존재하지 않습니다.

3. 결측치 중 '리츠' 포함 종목 수: 0개
이것은 사용자님의 현재 데이터셋(all_kospi_df)이 이미 리츠를 어느 정도 걸러낸 상태이거나, 리츠들이 결측치 없이 잘 매칭되었다는 뜻입니다. 하지만 위 분석 리스트에 나온 HD현대(지주사), 현대중공업지주 등을 보면 여전히 지주사 및 금융 관련 성격의 종목들은 남아있음을 알 수 있습니다.

결론: 앞으로 어떻게 하면 될까요?
지금 데이터는 로직에 따라 아주 잘 정제되고 있습니다. 결측치 1,380행은 다음과 같은 성격이므로 과감히 dropna() 하셔도 무방합니다.

부실 기업 (Value NaN): 가치 투자의 대상이 아니므로 제외.

이전 상장주 (Merge Miss): 코스닥 시절 재무 데이터가 코스피 파일에 없어서 생긴 누락. (이걸 살리려면 코스닥 BPS 데이터도 합쳐야 하는데, 분석 범위가 코스피라면 굳이 안 하셔도 됩니다.)

신규 상장주: 과거 재무 데이터가 물리적으로 존재하지 않음.

=== merged_df 기본 정보 ===
shape: (3998, 7)
<class 'pandas.core.frame.DataFrame'>
RangeIndex: 3998 entries, 0 to 3997
Data columns (total 7 columns):
 #   Column       Non-Null Count  Dtype
---  ------       --------------  -----
 0   종목명          3998 non-null   object
 1   year         3998 non-null   int64
 2   BPS          3965 non-null   float64
 3   ticker       3532 non-null   object
 4   lstg_st_cnt  3532 non-null   float64
 5   mkt_cap      3532 non-null   float64
 6   bookvalue    3501 non-null   float64
dtypes: float64(4), int64(1), object(2)
memory usage: 218.8+ KB
None

=== 컬럼별 결측치 수 ===
종목명              0
year             0
BPS             33
ticker         466
lstg_st_cnt    466
mkt_cap        466
bookvalue      497
dtype: int64

=== monthly_df 기본 정보 ===
shape: (38778, 6)
   year_month  ticker       mkt_cap     bookvalue      BEME  bv_year
18    2021-07  000020  409196035500  3.008778e+11  0.735290     2020
19    2021-08  000020  414782329500  3.008778e+11  0.725387     2020
20    2021-09  000020  498576739500  3.008778e+11  0.603473     2020
21    2021-10  000020  456679534500  3.008778e+11  0.658838     2020
22    2021-11  000020  424558344000  3.008778e+11  0.708684     2020
23    2021-12  000020  407799462000  3.008778e+11  0.737808     2020
24    2022-01  000020  326798199000  3.008778e+11  0.920684     2020
25    2022-02  000020  353333095500  3.008778e+11  0.851542     2020
26    2022-03  000020  381264565500  3.008778e+11  0.789158     2020
27    2022-04  000020  354729669000  3.008778e+11  0.848189     2020
28    2022-05  000020  332384493000  3.008778e+11  0.905210     2020
29    2022-06  000020  270655944300  3.008778e+11  1.111662     2020
30    2022-07  000020  294677008500  3.312672e+11  1.124171     2021
31    2022-08  000020  280711273500  3.312672e+11  1.180100     2021
32    2022-09  000020  230713942200  3.312672e+11  1.435835     2021
33    2022-10  000020  252221174100  3.312672e+11  1.313400     2021
34    2022-11  000020  251941859400  3.312672e+11  1.314856     2021
35    2022-12  000020  258645412200  3.312672e+11  1.280778     2021
36    2023-01  000020  261997188600  3.312672e+11  1.264392     2021
37    2023-02  000020  251941859400  3.312672e+11  1.314856     2021

=== 컬럼별 결측치 수 ===
year_month       0
ticker           0
mkt_cap          0
bookvalue     1380
BEME          1380
bv_year          0
dtype: int64

==================================================
     [결측치 발생 종목 TOP 20 분석]
==================================================
    ticker        종목명  bv_year  missing_months
1   003280       흥아해운     2021              12
2   003620     KG모빌리티     2021              12
9   012170    키위미디어그룹     2020              12
3   003620     KG모빌리티     2022              12
4   003620        쌍용차     2021              12
5   003620        쌍용차     2022              12
14  022100      포스코DX     2023              12
8   012170       아센디오     2020              12
17  034230      파라다이스     2023              12
43  278470       에이피알     2023              12
35  248070        솔루엠     2020              12
38  267250       HD현대     2021              12
32  137310   에스디바이오센서     2020              12
28  100090    SK오션플랜트     2022              12
26  097520       엠씨넥스     2020              12
24  090460       비에이치     2022              12
20  066970       엘앤에프     2023              12
18  062040       산일전기     2023              12
40  267250    현대중공업지주     2021              12
44  302440  SK바이오사이언스     2020              12

--------------------------------------------------
     [상위 10개 결측 종목 상세 진단]
--------------------------------------------------
    ticker      종목명  bv_year  missing_months                               diagnosis
1   003280     흥아해운     2021              12       Value NaN (원본에 종목은 있으나 BPS값이 NaN)
2   003620   KG모빌리티     2021              12       Value NaN (원본에 종목은 있으나 BPS값이 NaN)
9   012170  키위미디어그룹     2020              12       Value NaN (원본에 종목은 있으나 BPS값이 NaN)
3   003620   KG모빌리티     2022              12       Value NaN (원본에 종목은 있으나 BPS값이 NaN)
4   003620      쌍용차     2021              12       Value NaN (원본에 종목은 있으나 BPS값이 NaN)
5   003620      쌍용차     2022              12       Value NaN (원본에 종목은 있으나 BPS값이 NaN)
14  022100    포스코DX     2023              12  Merge Miss (BPS 원본에 종목 없음 - 신규상장/리츠 등)
8   012170     아센디오     2020              12       Value NaN (원본에 종목은 있으나 BPS값이 NaN)
17  034230    파라다이스     2023              12  Merge Miss (BPS 원본에 종목 없음 - 신규상장/리츠 등)
43  278470     에이피알     2023              12  Merge Miss (BPS 원본에 종목 없음 - 신규상장/리츠 등)

* 결측치 중 '리츠' 포함 종목 수: 0개